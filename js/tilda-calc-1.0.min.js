function tcalc__init(e, t) {
    var a = document.querySelector("#rec" + e);
    if (a) {
        var c = a.querySelectorAll('[data-input-lid="' + t + '"]'),
            r;
        if (a.querySelector(".t-conditional-form")) {
            var l = "conditional-form-init";
            a.addEventListener(l, (function() {
                for (var e = 0; e < c.length; e++) o(c[e])
            }), {
                once: !0
            })
        } else
            for (var n = 0; n < c.length; n++) o(c[n])
    }

    function o(t) {
        if (t && !t.getAttribute("data-init-calc")) {
            var c = t.querySelector(".t-calc");
            c || (c = a.querySelector(".t-calc"));
            var r = c.getAttribute("data-calc-expr"),
                l = a.querySelectorAll(".t-select, .t-radio, .t-checkbox, .t-img-select, .t-rate"),
                n = a.querySelectorAll(".t-inputquantity__btn"),
                o = a.querySelectorAll(".t-input"),
                i = a.querySelectorAll(".t-range");
            if (r) {
                var s = tcalc__getParseExpression(r = r.replace(/\s/g, "").replace(/,/g, "."));
                tcalc__cashOperandsFieldsEls(a, s), tcalc__cutAndHideFieldsValues(s), !0 !== s.error ? (t_onFuncLoad("t_throttle", (function() {
                    Array.prototype.forEach.call(o, (function(e) {
                        e.addEventListener("input", t_throttle((function() {
                            tcalc__changeVal(a, t, c, tcalc__calcValue(s))
                        })))
                    }))
                })), Array.prototype.forEach.call(l, (function(e) {
                    e.addEventListener("change", (function() {
                        tcalc__changeVal(a, t, c, tcalc__calcValue(s))
                    }))
                })), Array.prototype.forEach.call(n, (function(e) {
                    e.addEventListener("click", (function() {
                        setTimeout((function() {
                            tcalc__changeVal(a, t, c, tcalc__calcValue(s))
                        }))
                    }))
                })), Array.prototype.forEach.call(i, (function(e) {
                    Array.prototype.forEach.call(["click", "input", "change"], (function(r) {
                        e.addEventListener(r, (function() {
                            tcalc__changeVal(a, t, c, tcalc__calcValue(s))
                        }))
                    }))
                })), tcalc__changeVal(a, t, c, tcalc__calcValue(s)), t.setAttribute("data-init-calc", "y"), t.dispatchEvent(new CustomEvent("inputReady")), t.setAttribute("data-input-ready", "true")) : console.log("Please check math expression or input names(especially spaces) in rec" + e)
            } else console.log("Error: formula field is empty in rec" + e)
        }
    }
}

function tcalc__getParseExpression(e) {
    var t = e.split(""),
        a = [],
        c = [],
        r = 0,
        l = !0;
    a[r] = Object.create(null), a[r].str = "";
    for (var n = 0; n < t.length; n++) "(" !== t[n] && ")" !== t[n] && ("+" !== t[n] && "-" !== t[n] && "*" !== t[n] && "/" !== t[n] || l ? (a[r].str += t[n], l = !1) : (c[r] = t[n], a[++r] = Object.create(null), a[r].str = "", l = !0));
    return {
        str: e,
        operands: a,
        operators: c
    }
}

function tcalc__cashOperandsFieldsEls(e, t) {
    for (var a = 0; a < t.operands.length; a++) {
        var c = t.operands[a].str;
        if (isNaN(c)) {
            var r = e.querySelectorAll('[name="' + c + '"]'),
                l = Array.from(r).some((function(e) {
                    return Boolean(e.closest(".t-input-group[data-conditionals]"))
                }));
            if (!r) return console.log("Error: incorrect operand: " + c), void(t.error = !0);
            t.operands[a].type = "variable", t.operands[a].field = r, t.operands[a].hasConditionalField = l
        } else t.operands[a].type = "number", t.operands[a].value = +t.operands[a].str
    }
}

function tcalc__cutAndHideFieldsValues(e) {
    for (var t = 0; t < e.operands.length; t++) {
        var a = e.operands[t];
        "variable" === a.type && tcalc__prepareFieldsValues(a.field)
    }
}

function tcalc__prepareFieldsValues(e) {
    e.forEach((function(e) {
        if (e) {
            var t = e.classList.contains("t-select"),
                a = e.classList.contains("t-radio"),
                c = e.classList.contains("t-checkbox"),
                r = e.classList.contains("t-checkboxes__hiddeninput"),
                l = e.classList.contains("t-img-select"),
                n = e.classList.contains("t-img-select__hiddeninput"),
                o = e.classList.contains("t-rate");
            if (t) tcalc__cleanDropdownSelectValues(e);
            else if (c || a) tcalc__cleanRadioOrCheckboxValues(e);
            else if (l) tcalc__cleanImgSelectValues(e);
            else if (o) tcalc__setRateValues(e);
            else {
                var i = e.closest(".t-input-block");
                r ? tcalc__prepareFieldsValues(i.querySelectorAll(".t-checkbox")) : n && tcalc__prepareFieldsValues(i.querySelectorAll(".t-img-select"))
            }
        }
    }))
}

function tcalc__changeVal(e, t, a, c) {
    var r = t.querySelector(".t-calc__hiddeninput");
    r || (r = e.querySelector(".t-calc__hiddeninput"));
    var l = r.value;
    if (isNaN(c) ? (a.innerHTML = 0, r.value = 0) : (a.innerHTML = c, r.value = c), t.querySelector('input[type="hidden"][class^="t-calc__hidden__prod"]')) {
        var n = t.closest(".t-form__inputsbox"),
            o = t.querySelector(".t-calc__hidden__prod_img"),
            i = t.querySelector(".t-calc__hidden__prod_title"),
            s = "",
            u = "";
        o && (s = o.value || ""), i && (u = i.value || "NoName");
        var _ = {
                str: u,
                variables: []
            },
            p = _.str.match(/[A-z0-9_]+/gi);
        for (var d in p) {
            var v = n.querySelectorAll('[type="radio"][name="' + p[d] + '"]:checked');
            if (1 === v.length) _.variables.push({
                str: p[d],
                value: v[0].value
            });
            else {
                var f = n.querySelectorAll('[name="' + p[d] + '"]');
                1 === f.length && _.variables.push({
                    str: p[d],
                    value: f[0].value
                })
            }
        }
        for (var h in _.variables) {
            var y = _.variables[h].str,
                g = _.variables[h].value;
            if (g.indexOf("=") > 0) {
                for (var m = g.split(";"), b = [], d = 0; d < m.length; d++) {
                    var A = m[d];
                    A.indexOf("=") > 0 ? b.push(A.split("=")[0]) : b.push(A)
                }
                g = b.join(";")
            }
            y && g && (u = u.replace(new RegExp(y), g))
        }
        var E = e.querySelector(".t-quiz"),
            S = E ? E.querySelectorAll("button.t-submit") : n.querySelectorAll('[class$="-form__submit"] button.t-submit'),
            x = "#order:" + u + "=" + c;
        s && (x += ":::image=" + s), S.forEach((function(e) {
            e.setAttribute("href", x), e.setAttribute("type", "")
        }))
    }
    Number(l) !== c && t_triggerEvent(r, "change")
}

function tcalc__calcValue(e) {
    tcalc__getFieldsValues(e);
    for (var t = e.str, a = 0; a < e.operands.length; a++) {
        var c = e.operands[a],
            r, l = c.hasConditionalField && tcalc__isOperandFieldHidden(c) ? 0 : c.value;
        l = l < 0 ? "(0" + l + ")" : l, t = t.replace(c.str, l)
    }
    try {
        var n = tcalc__evaluate(tcalc__parse(t))
    } catch (o) {
        console.log("Something went wrong in form calculator! Please, connect support or developers")
    }
    return Math.round(10 * n) / 10
}

function tcalc__getFieldsValues(e) {
    for (var t = 0; t < e.operands.length; t++)
        if ("variable" == e.operands[t].type) {
            var a = e.operands[t].field;
            (a = Array.prototype.slice.call(a)).forEach((function(c) {
                if (c) {
                    var r = c.classList.contains("t-img-select") && "radio" === c.getAttribute("type"),
                        l = c.classList.contains("t-img-select__hiddeninput");
                    if (c.classList.contains("t-input") || c.classList.contains("t-range") || c.classList.contains("t-calc__hiddeninput")) {
                        var n = c.value;
                        tcalc__getFieldsValues__saveToArr(e.operands[t], n)
                    }
                    if (c.classList.contains("t-select")) {
                        var o = c.querySelector("option:checked"),
                            n = 0;
                        o && (n = o.getAttribute("data-calc-value")), tcalc__getFieldsValues__saveToArr(e.operands[t], n)
                    }
                    if (c.classList.contains("t-radio") || c.classList.contains("t-checkbox") || c.classList.contains("t-rate") || r) {
                        var i = Array.prototype.filter.call(a, (function(e) {
                                if (e.checked) return e
                            })),
                            n = 0;
                        i[0] && (n = i[0].getAttribute("data-calc-value")), tcalc__getFieldsValues__saveToArr(e.operands[t], n)
                    }
                    if (c.classList.contains("t-checkboxes__hiddeninput") || l) {
                        var s = c.closest(".t-input-block"),
                            u = l ? s.querySelectorAll(".t-img-select:checked") : s.querySelectorAll(".t-checkbox:checked"),
                            _ = 0;
                        Array.prototype.forEach.call(u, (function(e) {
                            var t = e.getAttribute("data-calc-value");
                            t = t ? t.replace(/[^0-9.]/g, "") : 0, _ += parseFloat(t)
                        })), tcalc__getFieldsValues__saveToArr(e.operands[t], _.toString())
                    }
                }
            }))
        }
}

function tcalc__getFieldsValues__saveToArr(e, t) {
    var a = parseInt(t, 10) < 0;
    t = t ? t.replace(/,/g, ".").replace(/[^0-9.]/g, "") : "", e.value = t ? parseFloat(t) : 0, a && (e.value = -e.value)
}

function t_triggerEvent(e, t) {
    var a;
    document.createEvent ? (a = document.createEvent("HTMLEvents")).initEvent(t, !0, !1) : document.createEventObject && ((a = document.createEventObject()).eventType = t), a.eventName = t, e.dispatchEvent ? e.dispatchEvent(a) : e.fireEvent ? e.fireEvent("on" + a.eventType, a) : e[t] ? e[t]() : e["on" + t] && e["on" + t]()
}

function tcalc__evaluate(e) {
    switch (e.type) {
        case "number":
            return parseFloat(e.value);
        case "+":
            return tcalc__evaluate(e.left) + tcalc__evaluate(e.right);
        case "-":
            return tcalc__evaluate(e.left) - tcalc__evaluate(e.right);
        case "*":
            return tcalc__evaluate(e.left) * tcalc__evaluate(e.right);
        case "/":
            return tcalc__evaluate(e.left) / tcalc__evaluate(e.right)
    }
}

function tcalc__parse(e) {
    var t = {
            tokens: tcalc__tokenize(e),
            position: 0
        },
        a = tcalc__parseExpr(t);
    if (t.position !== t.tokens.length) throw new SyntaxError("unexpected '" + tcalc__peek(t) + "'");
    return a
}

function tcalc__tokenize(e) {
    for (var t = [], a = /\s*([A-Za-z]+|[0-9.]+|\S)\s*/g, c; c = a.exec(e);) t.push(c[1]);
    return t
}

function tcalc__parseExpr(e) {
    for (var t = tcalc__parseMulExpr(e), a = tcalc__peek(e);
        "+" === a || "-" === a;) {
        var c;
        tcalc__consume(e), t = {
            type: a,
            left: t,
            right: tcalc__parseMulExpr(e)
        }, a = tcalc__peek(e)
    }
    return t
}

function tcalc__parseMulExpr(e) {
    for (var t = tcalc__parsePrimaryExpr(e), a = tcalc__peek(e);
        "*" === a || "/" === a;) {
        var c;
        tcalc__consume(e), t = {
            type: a,
            left: t,
            right: tcalc__parsePrimaryExpr(e)
        }, a = tcalc__peek(e)
    }
    return t
}

function tcalc__parsePrimaryExpr(e) {
    var t = tcalc__peek(e);
    if (tcalc__isNumber(t)) return tcalc__consume(e), {
        type: "number",
        value: t
    };
    if (tcalc__isName(t)) return tcalc__consume(e), {
        type: "name",
        id: t
    };
    if ("(" === t) {
        tcalc__consume(e);
        var a = tcalc__parseExpr(e);
        if (")" !== tcalc__peek(e)) throw new SyntaxError("expected )");
        return tcalc__consume(e), a
    }
    throw new SyntaxError("expected a number, a variable, or parentheses")
}

function tcalc__peek(e) {
    return e.tokens[e.position]
}

function tcalc__consume(e) {
    e.position++
}

function tcalc__isName(e) {
    return e && e.match(/^[A-Za-z]+$/)
}

function tcalc__isNumber(e) {
    return e && e.match(/^[0-9.]+$/)
}

function tcalc__isOperandFieldHidden(e) {
    if ("variable" === e.type) return Array.from(e.field).some((function(e) {
        var t;
        return "true" === e.closest(".t-input-group").getAttribute("data-hidden-by-condition")
    }))
}

function tcalc__cleanImgSelectValues(e) {
    var t = e.closest(".t-img-select__control"),
        a = t.querySelector(".t-img-select__text");
    if (a) {
        var c = a.textContent.trim();
        if (c) {
            var r = c.split("=");
            r.length < 2 || (r[0] ? e.setAttribute("value", r[0]) : e.setAttribute("value", t.querySelector(".t-img-select__indicator").getAttribute("data-original")), e.setAttribute("data-calc-value", r[1]), a.textContent = r[0])
        }
    }
}

function tcalc__setRateValues(e) {
    e.setAttribute("data-calc-value", e.value)
}

function tcalc__cleanRadioOrCheckboxValues(e) {
    var t = e.classList.contains("t-radio"),
        a = t ? e.closest(".t-radio__control") : e.closest(".t-checkbox__control"),
        c = a.querySelector(".t-checkbox__labeltext"),
        r = a.textContent.trim();
    if (c && (r = c.textContent), r) {
        var l = r.split("=");
        if (!(l.length < 2)) {
            var n = l[0],
                o = l[1];
            if (e.closest(".t-input-group_rd") && e.setAttribute("value", n), e.setAttribute("data-calc-value", o), c) c.textContent = n;
            else {
                var i;
                if (t ? e.classList.contains("t-radio-ownanswer") : e.classList.contains("t-checkbox-ownanswer")) {
                    var s = t ? a.querySelector(".t-radio__title") : a.querySelector(".t-checkbox__title");
                    return s && (s.textContent = n), void e.setAttribute("data-own-variant-title", n)
                }
                var u = a.querySelector("span:last-child");
                u && (u.textContent = n)
            }
        }
    }
}

function tcalc__cleanDropdownSelectValues(e) {
    var t = e.querySelectorAll("option");
    Array.prototype.forEach.call(t, (function(e) {
        var t = e.value;
        if (t) {
            var a = t.split("=");
            a.length < 2 || (e.value = a[0], e.innerHTML = a[0], e.setAttribute("data-calc-value", a[1]))
        }
    }))
}
Array.prototype.some || (Array.prototype.some = function(e) {
        "use strict";
        if (null == this) throw new TypeError("Array.prototype.some called on null or undefined");
        if ("function" != typeof e) throw new TypeError;
        for (var t = Object(this), a = t.length >>> 0, c = arguments.length >= 2 ? arguments[1] : void 0, r = 0; r < a; r++)
            if (r in t && e.call(c, t[r], r, t)) return !0;
        return !1
    }),
    function(e) {
        var t = e.matches || e.matchesSelector || e.webkitMatchesSelector || e.mozMatchesSelector || e.msMatchesSelector || e.oMatchesSelector;
        e.matches = e.matchesSelector = t || function e(t) {
            var e = document.querySelectorAll(t),
                a = this;
            return Array.prototype.some.call(e, (function(e) {
                return e === a
            }))
        }
    }(Element.prototype), Element.prototype.closest || (Element.prototype.closest = function(e) {
        for (var t = this; t && 1 === t.nodeType;) {
            if (Element.prototype.matches.call(t, e)) return t;
            t = t.parentElement || t.parentNode
        }
        return null
    });